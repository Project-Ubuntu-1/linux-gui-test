name: Linux GUI on GitHub Actions

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Install Desktop Environment and VNC
        run: |
          sudo apt-get update
          sudo apt-get install -y xfce4 xfce4-goodies tightvncserver
          echo "Setting up VNC server"
          mkdir -p ~/.vnc
          echo '#!/bin/bash' > ~/.vnc/xstartup
          echo 'startxfce4' >> ~/.vnc/xstartup
          chmod +x ~/.vnc/xstartup
          echo "Ubuntu1" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd

      - name: Start VNC Server
        run: vncserver :1

      - name: Setup Pinggy Tunnel
        run: |
          echo "CONNECT VIA VNC CLIENT TO:"
          echo "Password: Ubuntu1"
          echo "=========================================="
          echo "This connection will work for 1 hour"
          echo "=========================================="
          ssh -o StrictHostKeyChecking=no -p 443 -R 0:localhost:5901 tcp@a.pinggy.io
