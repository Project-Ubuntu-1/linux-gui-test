name: Windows Server 2022 RDP - FIXED
on: [workflow_dispatch]

jobs:
  windows-rdp:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Configure Windows RDP
      run: |
        # Enable RDP
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        
        # Create user
        net user termuxuser "Windows123!" /add
        net localgroup "Administrators" "termuxuser" /add
        net localgroup "Remote Desktop Users" "termuxuser" /add
        Start-Service -Name "TermService"

    - name: Start Proper TCP Tunnel
      run: |
        echo "=========================================="
        echo "ðŸªŸ WINDOWS SERVER 2022 READY!"
        echo "=========================================="
        echo "RDP Service: RUNNING on port 3389"
        echo "Username: termuxuser"
        echo "Password: Windows123!"
        echo ""
        echo "ðŸš€ Starting TCP Tunnel for RDP..."
        echo "WAIT FOR TCP FORWARDING INFO BELOW..."
        echo "=========================================="
        
        # This command specifically requests TCP forwarding
        ssh -o StrictHostKeyChecking=no -R 0:localhost:3389 serveo.net